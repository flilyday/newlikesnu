<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µê°• ì±„ìš°ê¸° í”„ë¡œí† íƒ€ì…</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ë¡œë“œ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* Noto Sans KR í°íŠ¸ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ , Interë¥¼ fallbackìœ¼ë¡œ ì§€ì • */
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        /* ì‹œê°„ ë ˆì´ë¸” ì»¬ëŸ¼ ê·¸ë¦¬ë“œ ì„¤ì • */
        #time-labels {
            display: grid;
            grid-template-rows: 0.5fr repeat(9, 1fr);
            gap: 2px;
            width: 4rem; /* ì‹œê°„ ì»¬ëŸ¼ ë„ˆë¹„ ê³ ì • */
        }

        /* ì‹œê°„í‘œ ê·¸ë¦¬ë“œ ì„¤ì • */
        #timetable-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: 0.5fr repeat(9, 1fr);
            gap: 2px;
        }

        /* ê·¸ë¦¬ë“œ ì…€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .grid-cell {
            background-color: white;
            border-radius: 8px;
            padding: 8px;
            min-height: 80px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            transition: all 0.2s ease-in-out;
        }

        /* í—¤ë” ì…€ ìŠ¤íƒ€ì¼ */
        .header-cell {
            background-color: #f1f3f5;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.875rem; /* 14px */
            color: #495057;
        }

        /* ì‹œê°„ ì…€ ìŠ¤íƒ€ì¼ */
        .time-cell {
            font-size: 0.75rem; /* 12px */
            font-weight: 500;
            color: #868e96;
            background-color: #f8f9fa;
            box-shadow: none;
            border: none;
            justify-content: flex-end;
            padding-right: 12px;
        }

        /* ê³µê°•(ë¹ˆ) ì…€ ìŠ¤íƒ€ì¼ */
        .gap-cell {
            background-color: #f8f9fa;
            border: 1px dashed #ced4da;
            cursor: pointer;
            box-shadow: none;
        }

        .gap-cell:hover, .gap-cell.selected {
            background-color: #e7f5ff;
            border-style: solid;
            border-color: #339af0;
        }

        /* ìˆ˜ê°•ê³¼ëª© ì…€ ìŠ¤íƒ€ì¼ */
        .class-cell {
            font-size: 0.875rem; /* 14px */
            line-height: 1.4;
            border-left-width: 4px;
            cursor: pointer; /* [NEW] ìˆ˜ì—… ì…€ë„ í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ */
        }

        .class-cell strong {
            font-weight: 600;
            color: #343a40;
            display: block;
            margin-bottom: 4px;
        }

        .class-cell span {
            font-size: 0.75rem; /* 12px */
            color: #495057;
        }

        /* [NEW] ì„ íƒëœ ìˆ˜ì—… ì…€ ìŠ¤íƒ€ì¼ */
        .class-cell.selected {
            box-shadow: 0 0 0 3px #1c7ed6; /* íŒŒë€ìƒ‰ í…Œë‘ë¦¬ */
            border-color: #1c7ed6;
        }

        /* ì¶”ì²œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .recommendation-card {
            background-color: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeIn 0.3s forwards;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .recommendation-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ì¶”ì²œ ì„¹ì…˜ í—¤ë” ìŠ¤íƒ€ì¼ */
        .recommendation-sector h2 {
            font-size: 1.25rem; /* 20px */
            font-weight: 600;
            color: #343a40;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            z-index: 40;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 50;
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            opacity: 0;
            transform: translate(-50%, -45%);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        #modal-overlay.active, #modal-content.active {
            display: block;
            opacity: 1;
        }

        #modal-content.active {
             transform: translate(-50%, -50%);
        }

        #modal-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
        }

        #modal-content .modal-details p {
            font-size: 1rem;
            line-height: 1.6;
            color: #555;
            margin-bottom: 1rem;
        }

        #modal-content .modal-details ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
            color: #555;
        }

    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="mb-6 flex flex-col sm:flex-row justify-between sm:items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">ê³µê°• ì±„ìš°ê¸°</h1>
                <p class="text-lg text-gray-600 mt-1">ë‚´ ì‹œê°„í‘œì˜ ë¹ˆí‹ˆì„ ì•Œì°¨ê²Œ!</p>
            </div>
            <!-- í´ë¦­í•œ ê³µê°•/ìˆ˜ì—… ì‹œê°„ ì •ë³´ í—¤ë” -->
            <div id="recommendation-header-text" class="text-lg font-semibold text-blue-600 mt-2 sm:mt-0">
                <!-- JS will update this -->
            </div>
        </header>

        <div class="flex flex-col gap-6">

            <!-- ì‹œê°„í‘œ -->
            <div class="w-full">
                <div class="flex gap-2">
                    <div id="time-labels"><!-- JSë¡œ ì±„ì›Œì§ --></div>
                    <div id="timetable-grid" class="flex-1"><!-- JSë¡œ ì±„ì›Œì§ --></div>
                </div>
            </div>

            <!-- [MODIFIED] ì¶”ì²œ ì„¹ì…˜ (ë™ì  ì»¨í…ì¸  ì˜ì—­) -->
            <div id="recommendation-display-area" class="w-full mt-4 hidden">
                <!-- JS will populate this area with either gap recs or class recs -->
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ (íŒì—…) ì°½ -->
    <div id="modal-overlay"></div>
    <div id="modal-content">
        <button id="modal-close-btn" class="absolute top-4 right-6 text-3xl font-light text-gray-500 hover:text-gray-800">&times;</button>
        <h3 id="modal-title"></h3>
        <div id="modal-details" class="modal-details">
            <!-- JS will populate this -->
        </div>
    </div>


    <script>
        // --- ë°ì´í„° ---

        // [MODIFIED] í•™ìƒ ìˆ˜ê°•ê³¼ëª© ë°ì´í„° (ID ì¶”ê°€)
        const studentSchedule = [
            { id: 'c1', day: 'Mon', start: 9, duration: 2, title: 'ì–‘ê¶', loc: 'ì¢…í•©ì²´ìœ¡ê´€', color: 'bg-red-100 border-red-300' },
            { id: 'c2', day: 'Mon', start: 14, duration: 2, title: 'ë°ì´í„° ê³¼í•™ ì…ë¬¸', loc: 'ì •ë³´ê´€ 301', color: 'bg-indigo-100 border-indigo-300' },
            { id: 'c3', day: 'Tue', start: 14, duration: 2, title: 'ì‚¬ëŒë‹¤ìš´ ì‚¬ëŒì˜ ê¸¸', loc: 'ì§„ë¦¬502', color: 'bg-pink-100 border-pink-300' },
            { id: 'c4', day: 'Wed', start: 10, duration: 2, title: 'ê¸°ì´ˆì½”ë”©', loc: 'ê³µí•™ê´€501', color: 'bg-green-100 border-green-300' },
            { id: 'c5', day: 'Thu', start: 15, duration: 2, title: 'ì¬ë‚œ ë° ì•ˆì „ê´€ë¦¬', loc: 'ì¡°í˜•214', color: 'bg-blue-100 border-blue-300' },
            { id: 'c6', day: 'Thu', start: 17, duration: 2, title: 'ê³ ê¸‰ í†µê³„í•™', loc: 'ìì—°ëŒ€ 205', color: 'bg-orange-100 border-orange-300' },
            { id: 'c7', day: 'Fri', start: 9, duration: 2, title: 'í”„ë ˆì  í…Œì´ì…˜ (ê¸°ì—…ê°€ì •ì‹ )', loc: 'ì¡°í˜•214', color: 'bg-purple-100 border-purple-300' },
            { id: 'c8', day: 'Fri', start: 13, duration: 2, title: 'ì°½ì—… ì„¸ë¯¸ë‚˜', loc: 'ê²½ì˜ëŒ€ 101', color: 'bg-teal-100 border-teal-300' }
        ];

        // [NEW] ìˆ˜ì—…-ì—°ê´€ ì¶”ì²œ ë°ì´í„°
        const courseRecommendations = {
            'c1': { // ì–‘ê¶
                recommendedBooks: [
                    { id: 'cr_c1_1', title: 'ì–‘ê¶ 101', desc: 'ê¸°ì´ˆë¶€í„° ê³ ê¸‰ ê¸°ìˆ ê¹Œì§€', details: '<p>ì–‘ê¶ì˜ ëª¨ë“  ê²ƒì„ ë‹¤ë£¨ëŠ” ì…ë¬¸ì„œì…ë‹ˆë‹¤.</p><ul><li>ì €ì: ê¹€ê¶ìˆ˜</li><li>ì¶œíŒì‚¬: í•œêµ­ì²´ìœ¡ì¶œíŒì‚¬</li></ul>' },
                    { id: 'cr_c1_2', title: 'ìŠ¤í¬ì¸  ì‹¬ë¦¬í•™', desc: 'ë©˜íƒˆ ê´€ë¦¬ì˜ ì¤‘ìš”ì„±', details: '<p>ì§‘ì¤‘ë ¥ê³¼ í‰ì •ì‹¬ì„ ìœ ì§€í•˜ëŠ” ë°©ë²•ì„ ë°°ì›ë‹ˆë‹¤.</p>' }
                ],
                recommendedLectures: [
                    { id: 'cl_c4_1', title: 'ìƒí™œì½”ë”©: Python', desc: 'ë¬´ë£Œ ì˜¨ë¼ì¸ ì½”ë”© ê°•ì˜', details: '<p>ìœ ëª…í•œ \'ìƒí™œì½”ë”©\'ì˜ íŒŒì´ì¬ ê°•ì˜ì…ë‹ˆë‹¤. ê¸°ì´ˆë¥¼ ë‹¤ì§€ê¸° ì¢‹ìŠµë‹ˆë‹¤.</p>' }
                ]
            },
            'c5': { // ì¬ë‚œ ë° ì•ˆì „ê´€ë¦¬
                recommendedPapers: [
                    { id: 'cp_c5_1', title: 'ë„ì‹œ ì¬ë‚œ ê´€ë¦¬ ì‹œìŠ¤í…œ ê³ ì°°', desc: 'ìµœì‹  ì¬ë‚œ ê´€ë¦¬ íŠ¸ë Œë“œ', details: '<p>ìµœê·¼ ë„ì‹œí˜• ì¬ë‚œì— ëŒ€ë¹„í•˜ëŠ” ì‹œìŠ¤í…œì— ëŒ€í•œ ë…¼ë¬¸ì…ë‹ˆë‹¤.</p>' }
                ],
                recommendedLectures: [
                    { id: 'cl_c5_1', title: 'êµ­ë¯¼ì•ˆì „ë°©ì†¡', desc: 'ì‹¤ìƒí™œ ì•ˆì „ ìˆ˜ì¹™', details: '<p>ë‹¤ì–‘í•œ ì¬ë‚œ ìƒí™©ì— ëŒ€ë¹„í•˜ëŠ” ìš”ë ¹ì„ ë°°ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>' }
                ]
            },
            'c6': { // ê³ ê¸‰ í†µê³„í•™
                required: [
                    { id: 'cr_c6_1', title: 'í˜„ëŒ€ í†µê³„í•™', desc: 'ìˆ˜ì—… í•„ìˆ˜ êµì¬', details: '<p>ìˆ˜ë¦¬í†µê³„í•™ì˜ ê¸°ì´ˆë¥¼ ë‹¤ë£¨ëŠ” êµì¬ì…ë‹ˆë‹¤.</p>' }
                ],
                recommendedPapers: [
                    { id: 'cp_c6_1', title: 'The Future of Data Analysis', desc: 'J. Tukey (1962)', details: '<p>ë°ì´í„° ë¶„ì„ì˜ ë¯¸ë˜ë¥¼ ì˜ˆê²¬í•œ ê³ ì „ ë…¼ë¬¸ì…ë‹ˆë‹¤.</p>' }
                ]
            },
            'c7': { // í”„ë ˆì  í…Œì´ì…˜ (ê¸°ì—…ê°€ì •ì‹ )
                recommendedBooks: [
                    { id: 'cr_c7_1', title: 'TEDì²˜ëŸ¼ ë§í•˜ê¸°', desc: 'ì²­ì¤‘ì„ ì‚¬ë¡œì¡ëŠ” ë²•', details: '<p>ì„±ê³µì ì¸ í”„ë ˆì  í…Œì´ì…˜ì˜ ë¹„ë°€ì„ ë‹´ì€ ì±…ì…ë‹ˆë‹¤.</p>' }
                ],
                recommendedLectures: [
                    { id: 'cl_c7_1', title: 'ìœ íŠœë¸Œ: ìŠ¤í‹°ë¸Œ ì¡ìŠ¤ ë°œí‘œ', desc: 'ì „ì„¤ì˜ í”„ë ˆì  í…Œì´ì…˜', details: '<p>ìŠ¤í‹°ë¸Œ ì¡ìŠ¤ì˜ ì•„ì´í° ë°œí‘œ ì˜ìƒì„ ë¶„ì„í•´ë³´ì„¸ìš”.</p>' }
                ]
            },
            'c8': { // ì°½ì—… ì„¸ë¯¸ë‚˜
                recommendedBooks: [
                    { id: 'cr_c8_1', title: 'ë¦° ìŠ¤íƒ€íŠ¸ì—…', desc: 'ì‹¤íŒ¨í•˜ì§€ ì•ŠëŠ” ì°½ì—…', details: '<p>í˜„ëŒ€ ìŠ¤íƒ€íŠ¸ì—…ì˜ í•„ë…ì„œì…ë‹ˆë‹¤.</p>' }
                ],
                recommendedPapers: [
                    { id: 'cp_c8_1', title: 'Why the Lean Start-Up Changes Everything', desc: 'Harvard Business Review', details: '<p>ë¦° ìŠ¤íƒ€íŠ¸ì—… ë°©ë²•ë¡ ì— ëŒ€í•œ HBR ì•„í‹°í´ì…ë‹ˆë‹¤.</p>' }
                ]
            }
        };

        // ê³µê°• ì‹œê°„ ì¶”ì²œ ë°ì´í„°
        const allRecommendations = [
            // ... (ê¸°ì¡´ ê³µê°• ì¶”ì²œ ë°ì´í„°ëŠ” ë™ì¼í•˜ê²Œ ìœ ì§€) ...
            { id: 5, category: 'library', title: 'ë„ì„œì¶”ì²œ: \'ì‚¬í”¼ì—”ìŠ¤\' ì½ê¸°', type: 'ë„ì„œì¶”ì²œ', duration: 1, desc: 'ì¤‘ì•™ë„ì„œê´€ \'ì´ë‹¬ì˜ ì¶”ì²œë„ì„œ\'. 1ì‹œê°„ ì§‘ì¤‘ ë…ì„œ.', details: '<p>... (ìƒì„¸ë‚´ìš©) ...</p>'},
            { id: 9, category: 'library', title: 'ë…¼ë¬¸ ì½ê¸°: \'ì±—GPTì˜ êµìœ¡ì  í™œìš©\'', type: 'ë…¼ë¬¸/ë„ì„œ', duration: 1, desc: 'ìµœì‹  AI ê´€ë ¨ êµìœ¡í•™ ë…¼ë¬¸ ì½ê¸°. (ìƒì‹œ).', details: '<p>... (ìƒì„¸ë‚´ìš©) ...</p>'},
            { id: 1, category: 'class', title: 'ë„ì„œê´€ \'ë°ì´í„° ë¶„ì„\' ìŠ¤í„°ë””', type: 'ìŠ¤í„°ë””', day: 'Mon', start: 10, duration: 2, desc: 'ì¤‘ì•™ë„ì„œê´€ 1ì¸µ ìŠ¤í„°ë””ë£¸ì—ì„œ ì§„í–‰. R, íŒŒì´ì¬ ê¸°ì´ˆ.', details: '<h3>... (ìƒì„¸ë‚´ìš©) ...</h3>'},
            { id: 3, category: 'class', title: 'ì·¨ì—…ì§€ì›íŒ€ \'AIì‹œëŒ€ì˜ ìê¸°ì†Œê°œì„œ\' íŠ¹ê°•', type: 'íŠ¹ê°•', day: 'Fri', start: 14, duration: 2, desc: 'í•™ìƒíšŒê´€ 2ì¸µ ëŒ€ê°•ë‹¹. í˜„ì§ì ë©˜í† ë§ í¬í•¨.', details: '<h3>... (ìƒì„¸ë‚´ìš©) ...</h3>'},
            { id: 4, category: 'class', title: '\'ì¸ê³µì§€ëŠ¥ ì…ë¬¸\' ì˜¨ë¼ì¸ ê°•ì¢Œ', type: 'ì¶”ì²œê°•ì˜', duration: 1, desc: 'ìš°ë¦¬ ëŒ€í•™ MOOC. 1ì‹œê°„ ë‹¨ìœ„ë¡œ í•™ìŠµ ê°€ëŠ¥. (ìƒì‹œ).', details: '<p>... (ìƒì„¸ë‚´ìš©) ...</p>'},
            { id: 7, category: 'class', title: 'ì½”ë”© ë™ì•„ë¦¬ \'íŒŒì´ì¬ ê¸°ì´ˆ\' ì„¸ì…˜', type: 'ìŠ¤í„°ë””', day: 'Wed', start: 15, duration: 2, desc: 'ì œ1ê³µí•™ê´€ 101í˜¸. ë¹„ì „ê³µì í™˜ì˜.', details: '<p>... (ìƒì„¸ë‚´ìš©) ...</p>'},
            { id: 2, category: 'cultural', title: 'ì¤‘ì•™ê´‘ì¥ ë°´ë“œ ë²„ìŠ¤í‚¹', type: 'ë¬¸í™”í–‰ì‚¬', day: 'Wed', start: 13, duration: 1, desc: 'ì¤‘ì•™ê´‘ì¥ íŠ¹ì„¤ ë¬´ëŒ€. ë°´ë“œ ë™ì•„ë¦¬ \'ì‚¬ìš´ë“œì›¨ì´ë¸Œ\' ê³µì—°.', details: '<h3>... (ìƒì„¸ë‚´ìš©) ...</h3>'},
            { id: 6, category: 'cultural', title: 'í•™ìƒíšŒê´€ \'ëª…ìƒê³¼ íë§\' í”„ë¡œê·¸ë¨', type: 'ë¬¸í™”í–‰ì‚¬', day: 'Mon', start: 14, duration: 1, desc: 'í•™ìƒìƒë‹´ì„¼í„° ì£¼ê´€. 3ì¸µ íë§ì¡´. (ì„ ì°©ìˆœ).', details: '<p>... (ìƒì„¸ë‚´ìš©) ...</p>'},
            { id: 8, category: 'cultural', title: 'ì´í•™ìƒíšŒ ì£¼ê´€ \'í”Œë¦¬ë§ˆì¼“\'', type: 'ë¬¸í™”í–‰ì‚¬', day: 'Fri', start: 13, duration: 3, desc: 'ì¤‘ì•™ê´‘ì¥ ì¼ëŒ€. ë‹¤ì–‘í•œ ìˆ˜ê³µì˜ˆí’ˆê³¼ ë¨¹ê±°ë¦¬.', details: '<p>... (ìƒì„¸ë‚´ìš©) ...</p>'},
            { id: 10, category: 'cultural', title: 'ë°•ë¬¼ê´€ íŠ¹ë³„ ì „ì‹œ ê´€ëŒ', type: 'ë¬¸í™”í–‰ì‚¬', day: 'Tue', start: 12, duration: 1, desc: 'ìš°ë¦¬ ëŒ€í•™ ë°•ë¬¼ê´€ \'ì¡°ì„ ì˜ ë¯¸\' íŠ¹ë³„ì „.', details: '<p>... (ìƒì„¸ë‚´ìš©) ...</p>'}
        ];

        // --- ì „ì—­ ë³€ìˆ˜ ---
        const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
        const dayKorean = { 'Mon': 'ì›”', 'Tue': 'í™”', 'Wed': 'ìˆ˜', 'Thu': 'ëª©', 'Fri': 'ê¸ˆ' };
        const timePeriods = [9, 10, 11, 12, 13, 14, 15, 16, 17];
        const timeLabels = ['9:00', '10:00', '11:00', '12:00', '1:00', '2:00', '3:00', '4:00', '5:00'];

        const timetableGrid = document.getElementById('timetable-grid');
        const timeLabelsContainer = document.getElementById('time-labels');

        const recommendationHeaderText = document.getElementById('recommendation-header-text');
        const recommendationDisplayArea = document.getElementById('recommendation-display-area');

        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalTitle = document.getElementById('modal-title');
        const modalDetails = document.getElementById('modal-details');

        const scheduleMap = new Map();

        // --- í•¨ìˆ˜ ---

        /**
         * 1. ì‹œê°„í‘œ ê·¸ë¦¬ë“œ ì´ˆê¸°í™” ë° ë Œë”ë§
         */
        function initializeTimetable() {
            timetableGrid.innerHTML = '';
            timeLabelsContainer.innerHTML = '';

            const timeHeader = createCell('ì‹œê°„', 'header-cell time-cell-header');
            timeHeader.style.minHeight = 'auto';
            timeLabelsContainer.appendChild(timeHeader);

            timePeriods.forEach((period, index) => {
                const timeCell = createCell(timeLabels[index], 'header-cell time-cell');
                timeLabelsContainer.appendChild(timeCell);
            });

            days.forEach(day => {
                const dayHeader = createCell(dayKorean[day], 'header-cell');
                dayHeader.style.minHeight = 'auto';
                timetableGrid.appendChild(dayHeader);
            });

            timePeriods.forEach((period, index) => {
                days.forEach(day => {
                    const cellId = `${day}-${period}`;
                    scheduleMap.set(cellId, 'empty');
                    const cell = createCell('', 'grid-cell gap-cell', cellId);
                    cell.dataset.day = day;
                    cell.dataset.period = period;
                    timetableGrid.appendChild(cell);
                });
            });
        }

        /**
         * 2. ìˆ˜ê°•ê³¼ëª©ì„ ì‹œê°„í‘œì— ë°°ì¹˜
         */
        function placeStudentSchedule() {
            studentSchedule.forEach(course => {
                for (let i = 0; i < course.duration; i++) {
                    const period = course.start + i;
                    const cellId = `${course.day}-${period}`;
                    const cell = document.getElementById(cellId);

                    if (!cell) continue;

                    scheduleMap.set(cellId, 'filled');
                    cell.classList.remove('gap-cell');
                    cell.classList.add('class-cell', ...course.color.split(' '));

                    if (i === 0) {
                        cell.innerHTML = `
                            <strong>${course.title}</strong>
                            <span>${course.loc}</span>
                        `;
                        cell.style.gridRowStart = `span ${course.duration}`;

                        // [NEW] ìˆ˜ì—… ì…€ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                        cell.addEventListener('click', (e) => {
                            e.stopPropagation();
                            handleClassClick(cell, course);
                        });
                    } else {
                        cell.style.display = 'none';
                    }
                }
            });
        }

        /**
         * 3. ì—°ì†ëœ ê³µê°• ì‹œê°„ ê·¸ë£¹í™”
         */
        function groupAdjacentGaps() {
            let gapGroupId = 0;
            days.forEach(day => {
                let currentGapGroup = null;
                timePeriods.forEach(period => {
                    const cellId = `${day}-${period}`;
                    if (scheduleMap.get(cellId) === 'empty') {
                        if (currentGapGroup === null) {
                            gapGroupId++;
                            currentGapGroup = { id: gapGroupId, day: day, start: period, duration: 1 };
                        } else {
                            currentGapGroup.duration += 1;
                        }
                        scheduleMap.set(cellId, `gap-${gapGroupId}`);
                        const cell = document.getElementById(cellId);
                        cell.dataset.gapGroupId = gapGroupId;
                        cell.dataset.gapInfo = JSON.stringify(currentGapGroup);
                    } else {
                        currentGapGroup = null;
                    }
                });
            });

            for (let i = 1; i <= gapGroupId; i++) {
                const gapCells = document.querySelectorAll(`[data-gap-group-id='${i}']`);
                if (gapCells.length > 0) {
                    const firstCell = gapCells[0];
                    const gapInfo = JSON.parse(firstCell.dataset.gapInfo);

                    firstCell.style.gridRowStart = `span ${gapInfo.duration}`;
                    firstCell.dataset.gapDuration = gapInfo.duration;

                    firstCell.addEventListener('click', () => handleGapClick(firstCell, gapInfo));

                    for (let j = 1; j < gapCells.length; j++) {
                        gapCells[j].style.display = 'none';
                    }
                }
            }
        }

        /**
         * 4. ê³µê°• ì…€ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
         */
        function handleGapClick(cellElement, gapInfo) {
            // [MODIFIED] ëª¨ë“  ì„ íƒëœ ì…€(ìˆ˜ì—…, ê³µê°•) í•´ì œ
            document.querySelectorAll('.gap-cell.selected, .class-cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            cellElement.classList.add('selected');

            const recommendations = findRecommendations(gapInfo);
            displayGapRecommendations(gapInfo, recommendations); // [RENAMED]
        }

        /**
         * [NEW] 5. ìˆ˜ì—… ì…€ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
         */
        function handleClassClick(cellElement, course) {
            // [MODIFIED] ëª¨ë“  ì„ íƒëœ ì…€(ìˆ˜ì—…, ê³µê°•) í•´ì œ
            document.querySelectorAll('.gap-cell.selected, .class-cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            cellElement.classList.add('selected');

            const recommendations = courseRecommendations[course.id] || {};
            displayCourseRecommendations(course, recommendations);
        }

        /**
         * 6. ê³µê°• ì‹œê°„ì— ë§ëŠ” ì¶”ì²œ í™œë™ í•„í„°ë§
         */
        function findRecommendations(gapInfo) {
            const { day, start, duration } = gapInfo;

            return allRecommendations.filter(rec => {
                if (!rec.day && rec.duration <= duration) return true;
                if (rec.day === day && rec.start >= start && (rec.start + (rec.duration || 1)) <= (start + duration)) return true;
                return false;
            });
        }

        /**
         * 7. ê³µê°• ì¶”ì²œ ì •ë³´ íŒ¨ë„ì— í‘œì‹œ [RENAMED]
         */
        function displayGapRecommendations(gapInfo, recommendations) {
            recommendationDisplayArea.innerHTML = ''; // ì˜ì—­ ì´ˆê¸°í™”
            recommendationDisplayArea.classList.remove('hidden');

            // í—¤ë” í…ìŠ¤íŠ¸ ì„¤ì •
            const gapStartLabel = timeLabels[timePeriods.indexOf(gapInfo.start)];
            const gapEndLabelIndex = timePeriods.indexOf(gapInfo.start + gapInfo.duration - 1);
            const gapEndLabel = timeLabels[gapEndLabelIndex];
            const endTimeParts = gapEndLabel.split(':');
            const endHour = parseInt(endTimeParts[0]);
            const endMinute = parseInt(endTimeParts[1]) + 50;
            const formattedEndTime = `${endHour}:${endMinute < 10 ? '0' : ''}${endMinute}`;
            recommendationHeaderText.textContent = `${dayKorean[gapInfo.day]}ìš”ì¼ ${gapStartLabel} ~ ${formattedEndTime} (${gapInfo.duration}ì‹œê°„ ê³µê°•)`;

            // [NEW] ê³µê°• ì¶”ì²œ ì„¹ì…˜ ë™ì  ìƒì„±
            recommendationDisplayArea.innerHTML = `
                <div class="recommendation-sector mb-8">
                    <h2>ğŸ“š ë„ì„œê´€ í™œë™</h2>
                    <div id="library-recs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
                <div class="recommendation-sector mb-8">
                    <h2>ğŸ“ ìˆ˜ì—… í™œë™</h2>
                    <div id="class-recs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
                <div class="recommendation-sector">
                    <h2>ğŸ¨ ë¬¸í™” í™œë™</h2>
                    <div id="cultural-recs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
            `;

            const libraryRecsContainer = document.getElementById('library-recs');
            const classRecsContainer = document.getElementById('class-recs');
            const culturalRecsContainer = document.getElementById('cultural-recs');

            const libraryRecs = recommendations.filter(r => r.category === 'library');
            const classRecs = recommendations.filter(r => r.category === 'class');
            const culturalRecs = recommendations.filter(r => r.category === 'cultural');

            if (libraryRecs.length > 0) {
                libraryRecs.forEach((rec, i) => createRecommendationCard(libraryRecsContainer, rec, i, rec.type));
            } else {
                libraryRecsContainer.innerHTML = '<p class="text-gray-500 col-span-full">ì¶”ì²œ ë„ì„œê´€ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            if (classRecs.length > 0) {
                classRecs.forEach((rec, i) => createRecommendationCard(classRecsContainer, rec, i, rec.type));
            } else {
                classRecsContainer.innerHTML = '<p class="text-gray-500 col-span-full">ì¶”ì²œ ìˆ˜ì—…/ìŠ¤í„°ë”” í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            if (culturalRecs.length > 0) {
                culturalRecs.forEach((rec, i) => createRecommendationCard(culturalRecsContainer, rec, i, rec.type));
            } else {
                culturalRecsContainer.innerHTML = '<p class="text-gray-500 col-span-full">ì¶”ì²œ ë¬¸í™” í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        /**
         * [NEW] 8. ìˆ˜ì—… ì¶”ì²œ ì •ë³´ íŒ¨ë„ì— í‘œì‹œ
         */
        function displayCourseRecommendations(course, recommendations) {
            recommendationDisplayArea.innerHTML = ''; // ì˜ì—­ ì´ˆê¸°í™”
            recommendationDisplayArea.classList.remove('hidden');

            recommendationHeaderText.textContent = `'${course.title}' ìˆ˜ì—… ê´€ë ¨ ì¶”ì²œ ìë£Œ`;

            // ìˆ˜ì—… ì¶”ì²œ ì„¹ì…˜ ë™ì  ìƒì„±
            recommendationDisplayArea.innerHTML = `
                <div class="recommendation-sector mb-8">
                    <h2>ğŸ“˜ ì§€ì • ë„ì„œ</h2>
                    <div id="required-books" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
                <div class="recommendation-sector mb-8">
                    <h2>ğŸ“™ ì¶”ì²œ ë„ì„œ</h2>
                    <div id="recommended-books" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
                <div class="recommendation-sector mb-8">
                    <h2>ğŸ“„ ì¶”ì²œ ë…¼ë¬¸</h2>
                    <div id="recommended-papers" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
                <div class="recommendation-sector">
                    <h2>ğŸ’» ì¶”ì²œ ê°•ì˜</h2>
                    <div id="recommended-lectures" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
            `;

            const requiredBooksContainer = document.getElementById('required-books');
            const recommendedBooksContainer = document.getElementById('recommended-books');
            const recommendedPapersContainer = document.getElementById('recommended-papers');
            const recommendedLecturesContainer = document.getElementById('recommended-lectures');

            const { required = [], recommendedBooks = [], recommendedPapers = [], recommendedLectures = [] } = recommendations;

            if (required.length > 0) {
                required.forEach((rec, i) => createRecommendationCard(requiredBooksContainer, rec, i, 'ì§€ì •ë„ì„œ'));
            } else {
                requiredBooksContainer.innerHTML = '<p class="text-gray-500 col-span-full">ì§€ì • ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            if (recommendedBooks.length > 0) {
                recommendedBooks.forEach((rec, i) => createRecommendationCard(recommendedBooksContainer, rec, i, 'ì¶”ì²œë„ì„œ'));
            } else {
                recommendedBooksContainer.innerHTML = '<p class="text-gray-500 col-span-full">ì¶”ì²œ ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            if (recommendedPapers.length > 0) {
                recommendedPapers.forEach((rec, i) => createRecommendationCard(recommendedPapersContainer, rec, i, 'ì¶”ì²œë…¼ë¬¸'));
            } else {
                recommendedPapersContainer.innerHTML = '<p class="text-gray-500 col-span-full">ì¶”ì²œ ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            if (recommendedLectures.length > 0) {
                recommendedLectures.forEach((rec, i) => createRecommendationCard(recommendedLecturesContainer, rec, i, 'ì¶”ì²œê°•ì˜'));
            } else {
                recommendedLecturesContainer.innerHTML = '<p class="text-gray-500 col-span-full">ì¶”ì²œ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        /**
         * 9. ì¶”ì²œ ì¹´ë“œ ìƒì„± ë° ì´ë²¤íŠ¸ ë°”ì¸ë”© [MODIFIED]
         */
        function createRecommendationCard(container, rec, index, type) { // typeì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ
            const card = document.createElement('div');
            card.className = 'recommendation-card';
            card.style.animationDelay = `${index * 0.1}s`;

            // [MODIFIED] type íŒŒë¼ë¯¸í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒ‰ìƒ ê²°ì •
            let typeColor = 'bg-gray-100 text-gray-700';
            if(type === 'ìŠ¤í„°ë””') typeColor = 'bg-blue-100 text-blue-800';
            if(type === 'ë¬¸í™”í–‰ì‚¬') typeColor = 'bg-purple-100 text-purple-800';
            if(type === 'íŠ¹ê°•') typeColor = 'bg-green-100 text-green-800';
            if(type.includes('ë„ì„œ')) typeColor = 'bg-yellow-100 text-yellow-800';
            if(type.includes('ì§€ì •')) typeColor = 'bg-red-100 text-red-800';
            if(type.includes('ë…¼ë¬¸')) typeColor = 'bg-indigo-100 text-indigo-800';
            if(type.includes('ê°•ì˜')) typeColor = 'bg-teal-100 text-teal-800';

            card.innerHTML = `
                <span class="inline-block px-2.5 py-0.5 rounded-full text-xs font-semibold ${typeColor} mb-2">
                    ${type}
                </span>
                <h4 class="font-semibold text-gray-800 mb-1">${rec.title}</h4>
                <p class="text-sm text-gray-600">${rec.desc}</p>
            `;

            card.addEventListener('click', () => openModal(rec));

            container.appendChild(card);
        }

        /**
         * 10. ëª¨ë‹¬ ì—´ê¸°
         */
        function openModal(rec) {
            modalTitle.textContent = rec.title;
            modalDetails.innerHTML = rec.details;

            modalOverlay.classList.add('active');
            modalContent.classList.add('active');
        }

        /**
         * 11. ëª¨ë‹¬ ë‹«ê¸°
         */
        function closeModal() {
            modalOverlay.classList.remove('active');
            modalContent.classList.remove('active');
        }

        /**
         * ìœ í‹¸ë¦¬í‹°: ê·¸ë¦¬ë“œ ì…€ ìƒì„±
         */
        function createCell(content, classNames = '', id = null) {
            const cell = document.createElement('div');
            cell.className = `grid-cell ${classNames}`;
            if (id) cell.id = id;
            cell.innerHTML = content;
            return cell;
        }

        // --- ì•± ì‹¤í–‰ ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeTimetable();
            placeStudentSchedule();
            groupAdjacentGaps();

            modalCloseBtn.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', closeModal);
        });

    </script>
</body>
</html>


